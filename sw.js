
const CACHE = 'mgd-cache-v1';
const ASSETS = ["/index.html", "/manifest.webmanifest", "/manifest.solo.webmanifest", "/manifest.partner.webmanifest", "/manifest.workshop.webmanifest", "/app/config.js", "/app/teaching.js", "/app/sigil.js", "/app/lore.js", "/app/breath.js", "/app/sanctum.js", "/app/datavault.js", "/app/pwa.js", "/app/kink.js", "/app/crest.js", "/app/nodes.js", "/app/ritual.js", "/app/profile.js", "/app/aftercare.js", "/app/scene.js", "/app/shadow.js", "/app/partner.js", "/app/theme.js", "/app/stage.js", "/app/badges.js", "/app/onboard.js", "/app/soundscape.js", "/app/stats.js", "/app/whispers.js", "/app/stage_editor.js", "/app/sync.js", "/app/panic.js", "/app/guardian.js", "/app/quizlets.js", "/app/sigilifier.js", "/app/timeline.js", "/app/calibration.js", "/app/planner.js", "/app/poster.js", "/app/i18n.js", "/app/partner_poster.js", "/app/hotkeys.js", "/app/compass.js", "/app/praxis.js", "/app/thermostat.js", "/app/invocation.js", "/app/agreements.js", "/app/harmony.js", "/app/journal.js", "/app/ceremony.js", "/app/safeword.js", "/app/demo.js", "/app/veil.js", "/app/tts.js", "/app/a11y.js", "/app/adaptive_lang.js", "/app/checklists.js", "/app/risk.js", "/app/ceremony_card.js", "/app/mic.js", "/app/recorder.js", "/app/themes_cb.js", "/app/pause_sync.js", "/app/heatmap.js", "/app/tour.js", "/app/glossary.js", "/app/checkins.js", "/app/resources.js", "/app/narrator.js", "/app/gate.js", "/app/hires.js", "/app/backup.js", "/app/golden.js", "/app/haptic_designer.js", "/app/theme_builder.js", "/app/suggestions.js", "/app/thermo_intensity.js", "/app/editor_history.js", "/app/command_palette.js", "/app/projector.js", "/app/playlist.js", "/app/ambient.js", "/app/countdown.js", "/app/midi.js", "/app/profiles.js", "/app/enc_backup.js", "/app/linter.js", "/app/vault.js", "/app/phase_vibe.js", "/app/playlist_ics.js", "/app/lint_rules.js", "/app/manifest_switcher.js", "/app/script_graph.js", "/app/keymap.js", "/app/emergency.js", "/app/ephemeral.js", "/app/partner_share.js", "/app/teleprompter.js", "/app/tp_sync.js", "/app/icon_forge.js", "/app/manifest_switcher_icons.js", "/app/coach.js", "/app/tp_chapters.js", "/app/workshop_pack.js", "/app/poster_tools.js", "/app/linter_presets.js", "/app/safety_pulse.js", "/app/portable.js", "/app/profile_switcher.js", "/app/sync_broadcast.js", "/app/debrief.js", "/app/facilitator_packs.js", "/app/vault_io.js", "/app/facilitator_print.js", "/app/perf_mode.js", "/app/aftercare_packet.js", "/app/community_packs.js", "/app/tp_autopace.js", "/app/first_run.js", "/app/rehearsal.js", "/app/consent_prompt.js", "/app/latency.js", "/app/soundboard.js", "/app/transcript.js", "/app/offline_qr.js", "/app/rooms.js", "/app/pedal.js", "/app/offline.js"];
self.addEventListener('install', (e)=>{ e.waitUntil(caches.open(CACHE).then(c=> c.addAll(ASSETS))); });
self.addEventListener('activate', (e)=>{ e.waitUntil(caches.keys().then(keys=> Promise.all(keys.filter(k=>k!==CACHE).map(k=> caches.delete(k))))); });
self.addEventListener('fetch', (e)=>{ const url = new URL(e.request.url); if (ASSETS.includes(url.pathname)) { e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request).then(resp=>{ const copy=resp.clone(); caches.open(CACHE).then(c=> c.put(e.request, copy)); return resp; }))); } });
